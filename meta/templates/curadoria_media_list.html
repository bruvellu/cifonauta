{% extends 'dashboard.html' %}
{% load static %}

{% block extra_head %}
<script src="{% static 'js/adm_select_all_records.js' %}" defer></script>
<script src="{% static 'js/adm_popup.js' %}" defer></script>
<script src="{% static 'js/adm_actions.js' %}" defer></script>
{% endblock %}

{% block title %}Lista de Mídias{% endblock %}

{% block dashboard_content %}

<h2>Lista de mídias para edição</h2>
{% if messages %}
<div class="messages-div">
    {% for message in messages %}
    <span {% if message.tags %} class="{{ message.tags }}" {% endif %}> {{ message }} </span>
    {% endfor %}
</div>
{% endif %}
{% if object_list %}
<form method="post">
{% csrf_token %}

<div id="behind-modal-container" class="behind-modal-container"></div>
<div id="modal-container" class="modal-container list-modal-container">
    <div>
        <div class="modal-header">
            <p>Processar em lote as mídias selecionadas</p>
            <button type="button" id="close-modal-button" class="close-modal-button">
                <div class='line1'></div>
                <div class='line2'></div>
            </button>
        </div>
        <div class="modal-body">
            {% for field in form %}
            {% if field == form.taxa_action %}
            <div class="modal-field-div">
                {{ field.label_tag }}
                {{ field }}
                <div id="taxa-wrapper" class="hide-div">
                    {{ form.taxa }}
                </div>
            </div>
            {% elif field == form.taxa %}
            {% else %}
            <div class="modal-field-div">
                {{ field.label_tag }}
                {{ field }}
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
    <button type="submit" class="pre-registration-submit">Processar</button>
</div>
<button type="button" id="open-modal-button" class="action-button">Ações em lotes</button>

<table class="table">
    <thead class="table-head">
        <tr>
            <th><input type="checkbox" id="select-all-records"></th>
            <th class="image-column">Mídia</th>
            <th class="title-column">Título</th>
            <th>Usuário</th>
            <th class="status-column">Status</th>
        </tr>
    </thead>
    <tbody class="table-body">
        {% for media in object_list %}
        <tr>
            <td>
                <input type="checkbox" class="selected-record" name="selected_media_ids" value="{{ media.id }}">
            </td>
            <td class="image-cedule">
                <a href="{% url 'edit_metadata' media.id %}">
                    {% if media.is_video %}
                    <video src="{{ media.coverpath.url }}"></video>
                    {% else %}
                    <img src="{{ media.coverpath.url }}">
                    {% endif %}
                </a>
            </td>
            <td class="text-cedule">{{ media.title_pt_br }}</td>
            <td>{{media.user}}</td>
            <td 
                class="text-cedule {% if media.status == 'not_edited' %}not-edited{% elif media.status == 'to_review' %}to-review{% else %}published{% endif %}"
            >
                {{ media.get_status_display }}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</form>

{% else %}
    <p>Não há imagens</p>
{% endif %}

{% endblock %}